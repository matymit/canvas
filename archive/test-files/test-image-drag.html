<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Image Drag Fix</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        .instructions {
            margin-bottom: 20px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 5px;
        }
        .test-buttons {
            margin-bottom: 20px;
        }
        button {
            margin-right: 10px;
            padding: 8px 16px;
            background: #4F46E5;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #3730A3;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="instructions">
        <h2>Testing Image Drag Position Persistence Fix</h2>
        <p><strong>Test Steps:</strong></p>
        <ol>
            <li>Open the canvas application below</li>
            <li>Add an image using the Image tool</li>
            <li>Select the image (click on it)</li>
            <li>Drag the image to a new position</li>
            <li>Release the mouse</li>
            <li><strong>Expected:</strong> Image stays in the new position</li>
            <li><strong>Previous bug:</strong> Image would snap back to original position</li>
        </ol>
        <p><strong>Check the browser console for debug messages showing position updates.</strong></p>
    </div>

    <div class="test-buttons">
        <button onclick="window.open('http://localhost:1425', '_blank')">Open Canvas App in New Tab</button>
        <button onclick="location.reload()">Refresh This Page</button>
    </div>

    <iframe src="http://localhost:1425" title="Canvas Application"></iframe>

    <div style="margin-top: 20px;">
        <h3>Debug Information</h3>
        <p>The fix modifies the SelectionModule to properly call the store's updateElement method within the withUndo wrapper, ensuring position changes are persisted to the store and trigger the ImageRendererAdapter to update the visual position.</p>

        <h4>Key Changes Made:</h4>
        <ul>
            <li>Fixed updateElementsFromNodes to use store.updateElement directly instead of through a closure</li>
            <li>Added proper withUndo wrapping for history tracking</li>
            <li>Added debug logging to track position updates</li>
            <li>Ensured ImageRendererAdapter subscription receives updates correctly</li>
        </ul>
    </div>
</body>
</html>