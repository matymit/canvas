# Marquee Selection + Connector/Mindmap Handoff

**Status:** Investigation summary (pre-fix)  
**Last Updated:** September 29, 2025

---

Transformers now route through `TransformLifecycleCoordinator` with snapshots generated by `TransformController`, but connectors still refused to move during marquee drags. Snapshot capture couldn’t reliably find the Konva groups emitted by `ConnectorRenderer`, so connectors stayed at `(0,0)`. Mindmap branches relied on store snapshots that never updated during drag, so they only rerouted at drag end.

Manual QA screenshots (2025-09-29) showed marquee selections picking up connectors while they remained stationary; the transformer disappeared on release and mindmap branches stretched then snapped back. `docs/architecture/canvas-implementation-progress.md` and `docs/known-issues.md` documented the regression.

---

## Findings
- `ConnectorRenderer` creates shapes that are not discoverable via `stage.findOne(#id)` unless each Konva group sets a stable `id`/`elementId`.
- Without a real node handle, `captureTransformSnapshot` cannot include connectors.
- Mindmap edges are data-driven; without live updates during drag, branches only reroute on drag end.

---

## Next Steps
1. Ensure `ConnectorRenderer` exposes a stable Konva group (`group.id(conn.id)` and/or `elementId` attribute) so `captureTransformSnapshot` brings connectors into `snapshot.connectors`.
2. In marquee’s `progressSelectionTransform`, translate connector groups by the drag delta so visuals stay in sync.
3. Update mindmap nodes during drag (store updates or renderer hooks) so branches follow live.
4. Optionally pause mindmap live routing during drag to avoid rollback, then resume on completion.
5. Re-test marquee with mixed sticky + connector + mindmap selections; expect `Transform snapshot` logs to show `connectors > 0`.

---

## Root Cause
Marquee drags bypassed the Konva Transformer, so `SelectionModule.captureTransformSnapshot` never executed. Connectors lacked IDs or were omitted from the snapshot, and mindmap live routing was paused (`pauseLiveRouting=true`) without compensating manual updates.

### Required Fixes
- Render connectors with a Konva group ID and name so snapshots can locate them.
- Apply drag deltas to connector endpoints during marquee progress.
- Update mindmap nodes (store or renderer) on every drag frame and reroute edges explicitly.
- Handle live routing flags carefully to avoid rollback while maintaining smooth visuals.
- Reattach the transformer after marquee drags so selection boxes remain visible.

These changes keep connectors and mindmap branches synchronized with marquee drags instead of snapping back on release.
